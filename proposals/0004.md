* Title: *Radicle client URI scheme*
* Champion: *@rudolfs, rudolfs@osins.org*
* Conversation:
  * [Radicle Community discussion][community]
  * [Shareable identifier discussion][shareable]
  * [Deep linking discussion][deeplink]
* References:
  * [List of URI schemes][urilist]

# Motivation

We have received multiple feature requests from our community regarding
deep-linking in our client application. A common way to enable such
functionality is to devise a URI scheme along with a custom protocol and
implement a handler which listens for requests on the given protocol in a
client application.

Given that there might be multiple competing Radicle client implementations and
to make sure that shared URIs are compatible with as many Radicle client
implementations as possible we decided to have a specification for our URI
scheme.


# Explanation

The main use case for a custom protocol is to be able to open a Radicle client
application by clicking on a link on the web in an external browser. The
Radicle client should be able to recognise what kind of resource is being
requested and be able to render the request accordingly.

Besides showing resources it might be valuable to perform certain actions on
said resources. For example a user may be able to start tracking a project by
clicking a link or initiate a fund transfer to a certain address.


# Recommendation

To make implementation easier we want to use existing URI parsing libraries,
therefore our URI scheme should be parsable according to [RFC 3986][rfc3986].

To make sure our URI scheme is extensible in the future and clients can provide
backwards compatibility for older links we should have a version identifier in
the scheme.

The URI scheme to be used by Radicle client applications should adhere to the
following scheme:

    radicle://<protocolVersion>/<context>/<entity>?action=<action>

Where:

- `radicle:` is the Radicle client protocol name.
- `<protocolVersion>` is a version number of the Radicle client protocol. This
  should be the letter `v` followed by a positive integer. The current value
  is: `v0`.
- `<context>` is a namespace to distinguish which component of the client
  application should handle the given request. Supported values:
  - `link` for code collaboration functionality
  - `ethereum` for Ethereum functionality
- `<entity>` can be one of the following, depending on `<context>`:
  - a `Radicle ID`
  - an Ethereum address or
  - an Ethereum transaction.
- `<action>` is the action that will be performed:
  - `Radicle ID`s support `show` and `track` actions
  - Ethereum addresses and transactions support only the `show` action.


## Examples

- show a `Radicle ID`

  `radicle://v0/link/rad:git:hwd1yrebu1gwhx8r5mmruz76nqxehibek6tbxo53jna3qdwyfo6be8y8gch?action=show`

- track a `Radicle ID`

  `radicle://v0/link/rad:git:hwd1yrebu1gwhx8r5mmruz76nqxehibek6tbxo53jna3qdwyfo6be8y8gch?action=track`

- show an Ethereum transaction

  `radicle://v0/ethereum/0xabce994f66d036440fabecb9bf29faeac45aaee3efdd81d38dd493f550c4822b?action=show`

- show an Ethereum wallet or contract address

  `radicle://v0/ethereum/0x5a9f9d53e3f838b3d6f5a6c2c11eb5be665d374c?action=show`


## Parsing implementation

In JavaScript environments our custom URI can be parsed via the
[URL][urlapi] and [URLSearchParams][searchapi] APIs:


```javascript
  const {protocol, pathname, search} = new URL("radicle://v0/link/rad:git:hwd1yrebu1gwhx8r5mmruz76nqxehibek6tbxo53jna3qdwyfo6be8y8gch?action=show")

  // protocol         → "radicle:"
  // pathname         → "//v0/link/rad:git:hwd1yrebu1gwhx8r5mmruz76nqxehibek6tbxo53jna3qdwyfo6be8y8gch"
  // search           → "?action=show"

  const [protocolVersion, context, entity] = pathname.split("/").slice(2)

  // protocolVersion  → "v0"
  // context          → "link"
  // entity           → "rad:git:hwd1yrebu1gwhx8r5mmruz76nqxehibek6tbxo53jna3qdwyfo6be8y8gch"

  const params = new URLSearchParams(search)
  const action = params.get("action")

  // action           → "show"
```


# Drawbacks

There are certain security implications related to supporting remote control
via custom protocols that implementers of a Radicle client should be aware of:

  - buffer overruns in parameter handling
  - remote code execution due to parameter escaping bugs
  - possible DoS attacks by overwhelming receiving application with requests
  - on macOS it's hard to implement registering custom protocols in an opt-in
    manner


# Open Questions

1) Should it be possible to pass in additional metadata about a requested
   `<entity>` via query string parameters?

   We considered this at one point in order for the UI to be able to render a
   `Radicle ID` as either a Project or a User without querying the network.


# Future possibilities

New requirements may be incorporated into this URI specification by
sequentially incrementing the protocol version number.


[community]: https://radicle.community/t/opening-upstream-via-links-on-the-web/1856
[deeplink]: https://github.com/radicle-dev/radicle-upstream/issues/1512
[rfc3986]: https://tools.ietf.org/html/rfc3986
[searchapi]: https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams
[shareable]: https://github.com/radicle-dev/radicle-upstream/issues/840
[urilist]: https://en.wikipedia.org/wiki/List_of_URI_schemes
[urlapi]: https://developer.mozilla.org/en-US/docs/Web/API/URL
